"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getEnvironment = void 0;

var _envCi = _interopRequireDefault(require("env-ci"));

var _heroku = _interopRequireDefault(require("./services/heroku"));

var _githubActions = _interopRequireDefault(require("./services/github-actions"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const services = [_heroku.default, _githubActions.default];

const getEnvironment = ({
  env = process.env
}) => {
  const ctx = {
    env
  };
  const service = services.find(service => service.detect(ctx)); // Internal service matched

  if (service) {
    return service.config(ctx);
  } // Fallback on env-ci detection


  const {
    name,
    commit,
    branch,
    prBranch
  } = (0, _envCi.default)(ctx);
  return {
    name: name || null,
    commit: commit || null,
    branch: prBranch || branch || null
  };
};

exports.getEnvironment = getEnvironment;